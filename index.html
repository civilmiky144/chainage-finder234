<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>BPPTPL Chainage Finder</title>
<style>
:root{
    --bppt-blue: #004a99;
    --bppt-green: #28a745;
    --safety-orange: #f97316;
    --bg: #f4f7f6;
    --surface: #ffffff;
    --border: #d1d5db;
    --text: #1f2937;
}
*{box-sizing:border-box;margin:0;padding:0}
body{color:var(--text);font-family:sans-serif;background:var(--bg);display:flex;flex-direction:column;height:100dvh}

header {
    background: white; padding: 12px; border-bottom: 4px solid var(--bppt-blue);
    display: flex; align-items: center; gap: 12px; flex-shrink: 0;
}
.logo { height: 40px; width: auto; }
.header-text h1 { margin: 0; font-size: 13px; color: var(--bppt-blue); text-transform: uppercase; }
.header-text p { margin: 0; font-size: 10px; color: var(--bppt-green); font-weight: bold; }

.content { flex: 1; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }

/* LARGE SINGLE LINE ORANGE CHAINAGE */
.ch-card { 
    background: white; border: 1px solid var(--border); border-radius: 16px; 
    width: 100%; padding: 30px 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.label { font-size: 10px; letter-spacing: 2px; color: #666; margin-bottom: 10px; font-weight: bold; }
#chValue { 
    font-size: 14vw; font-weight: 900; color: var(--safety-orange); 
    font-family: monospace; white-space: nowrap; 
}
#chDist { font-size: 12px; color: #888; margin-top: 10px; }

.gps-info { margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
.ibox { background: #eee; padding: 8px; border-radius: 6px; text-align: center; font-size: 10px; }

.btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: bold; margin-top: 20px; cursor: pointer; }
.btn-primary { background: var(--bppt-blue); color: white; }

footer {
    padding: 15px; background: white; text-align: center; font-size: 12px; 
    border-top: 1px solid var(--border); color: #333;
}
</style>
</head>
<body>

<header>
    <img src="1000678935.png" alt="Logo" class="logo">
    <div class="header-text">
        <h1>Beawar Pali Pindwara Tollway Pvt Ltd</h1>
        <p>Operations & Maintenance Division</p>
    </div>
</header>

<div class="content">
    <div class="ch-card">
        <div class="label">CURRENT CHAINAGE</div>
        <div id="chValue">--+---</div>
        <div id="chDist">Waiting for GPS...</div>
    </div>

    <div class="gps-info">
        <div class="ibox">ACCURACY<br><b id="infoAcc">--</b></div>
        <div class="ibox">PT DIST<br><b id="infoDist">--</b></div>
    </div>

    <button class="btn btn-primary" id="btnTrack" onclick="toggleTracking()">Start Tracking</button>
</div>

<footer>
    Prepared by - <strong>Mukesh Kumar Kollepara</strong>
</footer>

<script>
// I have truncated the points for the message, but keep your full 4889 points here
const CHAIN_PTS=[
["0+000",26.0617792,74.2991350],
["0+050",26.0619805,74.2986852],
// ... PASTE ALL YOUR 4889 POINTS HERE ...
["244+354",24.7800582,73.0298757]
];

let watchId = null;
let isTracking = false;

function distM(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return 2 * R * Math.asin(Math.sqrt(a));
}

function findNearest(lat, lon) {
    let bestDist = Infinity;
    let bestName = "--+---";
    for (let i = 0; i < CHAIN_PTS.length; i++) {
        const d = distM(lat, lon, CHAIN_PTS[i][1], CHAIN_PTS[i][2]);
        if (d < bestDist) {
            bestDist = d;
            bestName = CHAIN_PTS[i][0]; // This picks the Title from your KML
        }
    }
    return { name: bestName, dist: bestDist };
}

function toggleTracking() {
    if (isTracking) {
        navigator.geolocation.clearWatch(watchId);
        document.getElementById("btnTrack").textContent = "Start Tracking";
        isTracking = false;
    } else {
        isTracking = true;
        document.getElementById("btnTrack").textContent = "Stop Tracking";
        watchId = navigator.geolocation.watchPosition(pos => {
            const res = findNearest(pos.coords.latitude, pos.coords.longitude);
            document.getElementById("chValue").textContent = res.name;
            document.getElementById("infoAcc").textContent = "Â±" + pos.coords.accuracy.toFixed(1) + "m";
            document.getElementById("infoDist").textContent = res.dist.toFixed(1) + "m";
            document.getElementById("chDist").textContent = res.dist.toFixed(1) + "m from point";
        }, err => console.error(err), {enableHighAccuracy:true});
    }
}

function showScreen(name) {
    // Basic toggle for help screen if needed
}
</script>
</body>
</html>
