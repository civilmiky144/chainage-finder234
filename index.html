<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#004a99">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>BPPTPL Chainage Finder</title>
<style>
:root{
    --bppt-blue: #004a99;
    --bppt-green: #28a745;
    --safety-orange: #ff6600;
    --bg: #f8fafc;
    --surface: #ffffff;
    --border: #cbd5e1;
    --text: #0f172a;
    --muted: #64748b;
    --red: #ef4444;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;background:var(--bg)}
body{color:var(--text);font-family:-apple-system, system-ui, sans-serif;display:flex;flex-direction:column;height:100dvh}

header {
    background-color: white;
    padding: 12px 16px;
    border-bottom: 4px solid var(--bppt-blue);
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    flex-shrink: 0;
    z-index: 10;
}
.logo { height: 38px; width: auto; }
.header-text h1 { margin: 0; font-size: 13px; color: var(--bppt-blue); text-transform: uppercase; font-weight: 800; }
.header-text p { margin: 0; font-size: 10px; color: var(--bppt-green); font-weight: bold; }

.gps-pill{display:flex;align-items:center;gap:6px;background:var(--bg);border-radius:20px;padding:4px 10px;border:1px solid var(--border);margin-left: auto;}
.dot{width:8px;height:8px;border-radius:50%;background:var(--muted);}
.dot.live{background:var(--bppt-green);box-shadow:0 0 5px var(--bppt-green);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.35}}
.gps-txt{font-size:9px;color:var(--muted);font-weight:bold}

.scroll{flex:1;overflow-y:auto;padding:16px;-webkit-overflow-scrolling:touch}

/* MAIN CHAINAGE CARD */
.ch-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px 15px;margin-bottom:12px;text-align:center;box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);}
.ch-sublabel{font-size:10px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:10px;font-weight:700}
.ch-value{
    font-size: 13vw;
    font-weight: 900;
    color: var(--safety-orange);
    line-height: 1;
    white-space: nowrap; 
    font-family: "Courier New", Courier, monospace;
}
.ch-dist{font-size:12px;color:var(--muted);margin-top:14px;font-weight:500}

.near-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:12px;display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center;text-align:center}
.near-label{font-size:8px;color:var(--muted);text-transform:uppercase;}
.near-val{font-size:15px;font-weight:bold;color:var(--bppt-blue)}

.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.ibox{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px}
.ibox-lbl{font-size:8px;color:var(--muted);text-transform:uppercase;margin-bottom:2px}
.ibox-val{font-size:12px;color:var(--text);font-weight:700}

.btn{width:100%;padding:15px;border-radius:12px;border:none;font-size:13px;font-weight:800;letter-spacing:1px;text-transform:uppercase;cursor:pointer;margin-bottom:10px}
.btn-primary{background:var(--bppt-blue);color:#fff}
.btn-stop{background:var(--red);color:#fff}
.btn-ghost{background:white;color:var(--bppt-blue);border:1px solid var(--bppt-blue)}

footer {
    padding: 15px;
    background: #fff;
    text-align: center;
    font-size: 12px;
    color: #334155;
    border-top: 1px solid var(--border);
    flex-shrink: 0;
}

.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:rgba(15,23,42,0.9);color:white;padding:10px 20px;border-radius:25px;font-size:12px;opacity:0;transition:0.3s;z-index:999;pointer-events:none}
.toast.show{opacity:1}
</style>
</head>
<body>

<header>
    <img src="1000678935.png" alt="Logo" class="logo" onerror="this.style.display='none'">
    <div class="header-text">
        <h1>BPPTPL</h1>
        <p>O&M Division</p>
    </div>
    <div class="gps-pill">
        <div class="dot" id="gpsDot"></div>
        <span class="gps-txt" id="gpsTxt">OFF</span>
    </div>
</header>

<div class="screen" id="scMain">
  <div class="scroll">
    <div class="ch-card">
      <div class="ch-sublabel">Highway Chainage</div>
      <div class="ch-value" id="chValue">--+---</div>
      <div class="ch-dist" id="chDist">START TRACKING TO SYNC</div>
    </div>

    <div class="near-card" id="nearCard" style="display:none">
      <div><div class="near-label">PREVIOUS</div><div class="near-val" id="prevCh">--</div></div>
      <div style="color:#e2e8f0; font-weight:100; font-size:20px">|</div>
      <div><div class="near-label">NEXT</div><div class="near-val" id="nextCh">--</div></div>
    </div>

    <div class="info-grid">
      <div class="ibox"><div class="ibox-lbl">Accuracy</div><div class="ibox-val" id="infoAcc">--</div></div>
      <div class="ibox"><div class="ibox-lbl">Centerline Dist</div><div class="ibox-val" id="infoDist">--</div></div>
    </div>

    <button class="btn btn-primary" id="btnTrack" onclick="toggleTracking()">Start Tracking</button>
    <button class="btn btn-ghost" id="btnMark" onclick="copyChainage()" disabled>Copy Chainage</button>
  </div>
</div>

<footer>
    Prepared by - <strong>Mukesh Kumar Kollepara</strong><br>
    <span style="font-size:10px; color:var(--muted)">Senior Manager (O&M) - BPPTPL</span>
</footer>

<div class="toast" id="toast"></div>

<script>
// Coordinate Data (Truncated for space, ensured first and last points are here)
const CHAIN_PTS=[
["0+000",26.0617792,74.2991350],
["0+050",26.0619805,74.2986852],
["0+100",26.0621872,74.2982409],
["0+150",26.0623894,74.2977958],
["0+200",26.0625838,74.2973447],
["0+250",26.0627822,74.2968956],
["0+300",26.0629824,74.2964466],
["0+350",26.0631924,74.2959993],
["0+400",26.0634047,74.2955581],
["0+450",26.0636115,74.2951170],
["0+500",26.0638164,74.2946716],
// ... (Your thousands of points stay here)
["244+300",24.7805202,73.0300376],
["244+350",24.7800894,73.0298870],
["244+354",24.7800582,73.0298757]
];

// Logic Engine
let watchId = null;
let isTracking = false;
let lastCh = null;

function toggleTracking() { isTracking ? stopTracking() : startTracking(); }

function startTracking() {
    if (!navigator.geolocation) { showToast("GPS Not Supported"); return; }
    isTracking = true;
    document.getElementById("btnTrack").textContent = "Stop Tracking";
    document.getElementById("btnTrack").classList.replace("btn-primary", "btn-stop");
    
    watchId = navigator.geolocation.watchPosition(pos => {
        const {latitude: lat, longitude: lon, accuracy: acc} = pos.coords;
        document.getElementById("infoAcc").textContent = "Â±" + acc.toFixed(1) + " m";
        document.getElementById("gpsDot").className = "dot live";
        document.getElementById("gpsTxt").textContent = "LIVE";

        let bestDist = Infinity, bestIdx = 0;
        for (let i = 0; i < CHAIN_PTS.length; i++) {
            const d = distM(lat, lon, CHAIN_PTS[i][1], CHAIN_PTS[i][2]);
            if (d < bestDist) { bestDist = d; bestIdx = i; }
        }
        
        lastCh = CHAIN_PTS[bestIdx][0];
        document.getElementById("chValue").textContent = lastCh;
        document.getElementById("infoDist").textContent = bestDist.toFixed(1) + " m";
        document.getElementById("chDist").textContent = "Distance from centerline: " + bestDist.toFixed(1) + "m";
        document.getElementById("nearCard").style.display = "grid";
        document.getElementById("prevCh").textContent = bestIdx > 0 ? CHAIN_PTS[bestIdx-1][0] : "--";
        document.getElementById("nextCh").textContent = bestIdx < CHAIN_PTS.length-1 ? CHAIN_PTS[bestIdx+1][0] : "--";
        document.getElementById("btnMark").disabled = false;
    }, err => {
        showToast("GPS Error: " + err.message);
    }, {enableHighAccuracy: true});
}

function stopTracking() {
    navigator.geolocation.clearWatch(watchId);
    isTracking = false;
    document.getElementById("btnTrack").textContent = "Start Tracking";
    document.getElementById("btnTrack").classList.replace("btn-stop", "btn-primary");
    document.getElementById("gpsDot").className = "dot";
    document.getElementById("gpsTxt").textContent = "OFF";
    document.getElementById("btnMark").disabled = true;
}

function distM(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return 2 * R * Math.asin(Math.sqrt(a));
}

function copyChainage() {
    navigator.clipboard.writeText("BPPTPL Chainage: " + lastCh);
    showToast("Chainage Copied!");
}

function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2500);
}

function showScreen(s) {
    // Basic toggle for help screen
    showToast("Help coming soon");
}
</script>
</body>
</html>
