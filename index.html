<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#004a99">
<title>BPPTPL Chainage Finder</title>
<style>
:root{
    --bppt-blue: #004a99;
    --bppt-green: #28a745;
    --safety-orange: #FF8C00;
    --bg: #f4f7f6;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{
    color: #1f2937;
    font-family: -apple-system, system-ui, sans-serif;
    background: var(--bg);
    display: flex;
    flex-direction: column;
    height: 100vh;
    height: 100dvh;
}

/* HORIZONTAL BRANDED HEADER */
header {
    background: white;
    padding: 12px 16px;
    border-bottom: 4px solid var(--bppt-blue);
    display: flex;
    flex-direction: row; /* Horizontal alignment */
    align-items: center;
    justify-content: center; /* Centered as a group */
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    flex-shrink: 0;
}
.logo { height: 48px; width: auto; }
.header-text { text-align: left; } /* Text stays left-aligned relative to logo */
.header-text h1 { margin: 0; font-size: 13px; color: var(--bppt-blue); text-transform: uppercase; line-height: 1.2; letter-spacing: 0.3px; }
.header-text p { margin: 1px 0 0 0; font-size: 10px; color: var(--bppt-green); font-weight: bold; letter-spacing: 0.5px; }

.scroll-area { flex: 1; overflow-y: auto; padding: 20px; }

/* LARGE SINGLE LINE ORANGE CHAINAGE */
.ch-card {
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 20px;
    padding: 30px 15px;
    text-align: center;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
    margin-bottom: 15px;
}
.label {
    font-size: 11px;
    letter-spacing: 3px;
    color: #6b7280;
    margin-bottom: 15px;
    font-weight: 800;
    text-transform: uppercase;
}
#chValue {
    font-size: 14vw;
    font-weight: 900;
    color: var(--safety-orange);
    font-family: 'Courier New', Courier, monospace;
    white-space: nowrap;
    text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
}
#chDist { font-size: 13px; color: #9ca3af; margin-top: 15px; font-weight: 500; }

/* SECTION INFO CARD */
.section-card {
    background: #eef2ff;
    border: 1px solid #c7d2fe;
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 15px;
    display: none;
}
.sec-title { font-size: 14px; font-weight: 800; color: var(--bppt-blue); border-bottom: 1px solid #c7d2fe; padding-bottom: 5px; margin-bottom: 10px; text-align: center;}
.sec-detail { font-size: 13px; margin: 4px 0; }
.sec-phone { color: var(--bppt-blue); text-decoration: none; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; margin-top: 5px; padding: 5px 0; }

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    width: 100%;
    margin-bottom: 15px;
}
.ibox {
    background: #e5e7eb;
    padding: 10px;
    border-radius: 10px;
    text-align: center;
}
.ibox-lbl { font-size: 9px; color: #6b7280; font-weight: bold; margin-bottom: 4px; }
.ibox-val { font-size: 13px; color: var(--bppt-blue); font-weight: 800; }

.btn {
    width: 100%;
    padding: 18px;
    border-radius: 15px;
    border: none;
    font-size: 14px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.2s;
}
.btn-primary { background: var(--bppt-blue); color: white; }
.btn-stop { background: #ef4444; color: white; }
.btn:active { transform: scale(0.96); }

footer {
    padding: 15px;
    background: white;
    text-align: center;
    border-top: 1px solid #e5e7eb;
    font-size: 12px;
    color: #4b5563;
}

.toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: white;
    padding: 10px 20px;
    border-radius: 30px;
    font-size: 12px;
    opacity: 0;
    transition: 0.3s;
    pointer-events: none;
    z-index: 100;
}
.toast.show { opacity: 1; }
</style>
</head>
<body>

<header>
    <img src="1000678935.png" alt="BPPTPL Logo" class="logo">
    <div class="header-text">
        <h1>Beawar Pali Pindwara Tollway</h1>
        <p>MAINTENANCE DEPARTMENT</p>
    </div>
</header>

<div class="scroll-area">
    <div class="ch-card">
        <div class="label">Current Chainage</div>
        <div id="chValue">--+---</div>
        <div id="chDist">Start tracking outdoors</div>
    </div>

    <div class="section-card" id="sectionCard">
        <div class="sec-title" id="secTitle">SECTION --</div>
        <div class="sec-detail">In-charge: <strong id="secName">--</strong></div>
        <div class="sec-detail">Designation: <strong>Section In-charge</strong></div>
        <a href="" class="sec-phone" id="secLink">
            <span style="font-size: 18px;">&#9742;</span> <span id="secPhone">--</span>
        </a>
    </div>

    <div class="stats-grid">
        <div class="ibox"><div class="ibox-lbl">GPS ACCURACY</div><div class="ibox-val" id="infoAcc">--</div></div>
        <div class="ibox"><div class="ibox-lbl">DIST TO POINT</div><div class="ibox-val" id="infoDist">--</div></div>
    </div>

    <button class="btn btn-primary" id="btnTrack" onclick="toggleTracking()">Want Your Chainage Click Me</button>
</div>

<footer>
    Prepared by - <strong>Mukesh Kumar Kollepara</strong> (Sr.Manager)
</footer>

<div class="toast" id="toast"></div>

<script>
// --- YOUR FULL 4889 POINTS HERE ---
const CHAIN_PTS=[
["0+000",26.0617792,74.2991350],
["0+050",26.0619805,74.2986852],
// ... rest of points ...
["244+354",24.7800582,73.0298757]
];

const SECTION_DATA = {
    1: { name: "Mr. Sachin Gupta", phone: "8506878948", limit: 60 },
    2: { name: "Mr. Amit Khemwani", phone: "6375884003", limit: 120 },
    3: { name: "Section Incharge", phone: "9529826416", limit: 180 },
    4: { name: "Mr. Bhagwat Rathore", phone: "8619494508", limit: 999 }
};

let watchId = null;
let isTracking = false;

function distM(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return 2 * R * Math.asin(Math.sqrt(a));
}

function updateSectionUI(chainageTag) {
    const km = parseInt(chainageTag.split('+')[0]);
    let secNum = 1;
    if (km >= 180) secNum = 4;
    else if (km >= 120) secNum = 3;
    else if (km >= 60) secNum = 2;

    const data = SECTION_DATA[secNum];
    document.getElementById("sectionCard").style.display = "block";
    document.getElementById("secTitle").textContent = "SECTION " + secNum;
    document.getElementById("secName").textContent = data.name;
    document.getElementById("secPhone").textContent = data.phone;
    document.getElementById("secLink").href = "tel:" + data.phone;
}

function toggleTracking() {
    const btn = document.getElementById("btnTrack");
    if (isTracking) {
        navigator.geolocation.clearWatch(watchId);
        btn.textContent = "Want Your Chainage Click Me";
        btn.className = "btn btn-primary";
        document.getElementById("sectionCard").style.display = "none";
        isTracking = false;
    } else {
        isTracking = true;
        btn.textContent = "Stop Tracking";
        btn.className = "btn btn-stop";
        
        watchId = navigator.geolocation.watchPosition(pos => {
            let minD = Infinity;
            let nearestTag = "--+---";
            
            for (let i = 0; i < CHAIN_PTS.length; i++) {
                let d = distM(pos.coords.latitude, pos.coords.longitude, CHAIN_PTS[i][1], CHAIN_PTS[i][2]);
                if (d < minD) {
                    minD = d;
                    nearestTag = CHAIN_PTS[i][0]; 
                }
            }
            
            document.getElementById("chValue").textContent = nearestTag;
            document.getElementById("infoAcc").textContent = "Â±" + pos.coords.accuracy.toFixed(1) + "m";
            document.getElementById("infoDist").textContent = minD.toFixed(1) + "m";
            document.getElementById("chDist").textContent = minD.toFixed(1) + " m away from Project Highway";
            updateSectionUI(nearestTag);
        }, err => toast("GPS Error"), {enableHighAccuracy: true});
    }
}

function toast(m) {
    const t = document.getElementById("toast");
    t.textContent = m;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2500);
}
</script>
</body>
</html>
